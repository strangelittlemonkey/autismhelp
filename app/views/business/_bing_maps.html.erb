<script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0"></script>
<script type="text/javascript">
  function GetMap()
  {
    var myLat = null;
    var myLng = null;//<%= @lng %>;
    var options = {
      enableHighAccuracy: true,
      timeout: 5000,
      maximumAge: 0
    };
     
    function success(pos) {
      var crd = pos.coords;
      myLat = crd.latitude;
      myLng = crd.longitude;
      //alert('success!');
      //alert('' + myLat + ' ' + crd.longitude);

      displayMap();
      pinLocations();
    };
     
    function error(err) {
      console.warn('ERROR(' + err.code + '): ' + err.message);
    };

    function displayMap() {
      var location = new Microsoft.Maps.Location(myLat, myLng);
      var map = new Microsoft.Maps.Map(document.getElementById('bing_map'), 
        {credentials: 'Av3KxY1c6mhrQ-kkwXXiJLBVEbvUUs-VnYPFtfTGh443r4xyegm7QWbzFILo_mDa',
         center: location,
         mapTypeId: Microsoft.Maps.MapTypeId.road,
         showScalebar: false,
         showDashboard: false,
         zoom: 14});
      var pin = new Microsoft.Maps.Pushpin(location);
      if (myLat == 37.795 && myLng == -122.408) {
      }
      else {
        map.entities.push(pin);
        map.setView({
          center: location,
          zoom: 16
        });
      }
    };

    function pinLocations() {

    }

    navigator.geolocation.getCurrentPosition(success, error, options);
    //alert('Lat: ' + myLat + ' | Lng: ' + myLng);
    //console.log(getUrlVars());
    
  }
</script>